---
import { getCollection } from "astro:content";
import BaseLayout from "../../layouts/BaseLayout.astro";
import LikeButton from "../../components/islands/LikeButton";
import SaveButton from "../../components/islands/SaveButton";

const posts = await getCollection("posts");
const authors = await getCollection("authors");

const randomNumberComments = Array.from({ length: posts.length }, () => {
  return Math.floor(Math.random() * 50);
});
---

<BaseLayout title="posts">
  <section class="h-40 flex flex-col gap-4">
    {
      posts.map(({ slug, data }, index) => {
        const author = authors.find((author) => author.slug === data.author);

        return (
          <article class="box-border w-full items-center flex flex-col bg-white p-4 rounded-xl">
            <section class="w-full flex justify-start gap-3 items-center">
              <img
                src={author?.data.avatar}
                alt="avatar image"
                class="w-8 h-auto object-contain"
              />
              <div class="flex flex-col text-sm text-neutral-500">
                <span>{author?.data.name}</span>
                <span>{data.publishedAt}</span>
              </div>
            </section>

            <section class="w-full mt-6 inline-flex flex-col gap-2">
              <a
                href={"posts/" + slug}
                class="text-xl text-neutral-800 transition-colors hover:text-blue-500"
              >
                {data.description}
              </a>
              <div class="inline-flex gap-4">
                {data.tags.map((tag) => {
                  return (
                    <span class="text-sm text-neutral-400">{"#" + tag}</span>
                  );
                })}
              </div>
            </section>

            <section class="w-full mt-4 flex justify-around">
              <div class="flex flex-row-reverse gap-4">
                <div class="flex items-center justify-start gap-2">
                  <img
                    src="src/assets/images/comments.svg"
                    alt="comment icon"
                    class="w-5 h-auto object-contain"
                  />
                  <span>{randomNumberComments[index] + " Comments"}</span>
                </div>
                <LikeButton client:load />
              </div>
              <SaveButton client:load />
            </section>
          </article>
        );
      })
    }
  </section>
</BaseLayout>
